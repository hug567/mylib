# VLAN简介：

- VLAN：Virtual Local Area Network，虚拟局域网，是一种将物理局域网在逻辑上划分为多个独立广播域的技术；

- 工作原理：
	- 虚拟网络划分：管理员可根据需求将物理网络中的设备划分为多个VLAN，每个VLAN有唯一的VLAN ID标识。
	- VLAN封装：交换机根据端口配置将接收到的数据帧封装到对应VLAN中，并添加包含源地址、目的地址和VLAN ID的VLAN标签。
	- VLAN隔离：交换机端口按配置只接收特定VLAN的数据帧，实现不同VLAN间的隔离。
	- VLAN间通信：不同VLAN间通信需通过交换机上的路由功能，依据VLAN ID和路由表转发数据帧。

- 配置方法
	- 创建VLAN：在交换机上创建所需VLAN，并分配唯一ID。
	- 分配端口：将端口设置为相应VLAN成员。
	- VLAN间路由：如需VLAN间通信，要配置交换机或路由器上的VLAN间路由。
	- 安全设置：可配置访问控制列表或端口安全等功能，增强网络安全性。

- VLAN技术主要有以下几种分类：

	- 基于端口的VLAN：这是最常见的VLAN类型之一，通过交换机的端口来划分VLAN。每个端口可以配置为一个VLAN的成员，从而决定连接到该端口的设备属于哪个VLAN。

	- 基于MAC地址的VLAN：根据设备的MAC地址将其划分到不同的VLAN中。交换机内部会建立并维护一个MAC地址与VLAN ID的对应表，当设备发送数据帧时，交换机会根据源MAC地址查找对应表，将数据帧划分到相应的VLAN中。

	- 基于网络层协议的VLAN：根据数据帧所属的网络层协议（如IP、IPX等）来进行VLAN的划分。这种划分方式适用于多协议环境下的网络管理，但配置相对复杂，且不适用于只使用单一协议的环境。

	- 基于IP子网的VLAN：按照IP子网将设备划分到VLAN中。通常，每个VLAN都与一个或多个IP子网相关联，这种方式可以减少人工工作量，满足标准低的安全要求、流动性和简单的管理方面的要求。

	- 基于策略的VLAN：能实现多种分配方法，包括VLAN交换机端口、MAC地址、IP地址、网络层协议等。网络管理人员可根据自己的管理模式和本单位的需求来决定选择哪种类型的VLAN，灵活性强，但配置较为复杂，且需要频繁调整策略。

	- 按用户定义、非用户授权划分：为了适应特别的VLAN网络，根据具体的网络用户的特别要求来定义和设计VLAN，可以让非VLAN群体用户访问VLAN，不过需要提供用户密码，在得到VLAN管理的认证后才可以加入一个VLAN。



- 三层交换机端口的工作模式主要有以下几种：

1. **Access模式**
   - **接收数据时**：当接收到一个无标记帧（即没有VLAN标签的帧）的时候，打上自己的PVID（Port VLAN ID，端口所属VLAN的标识），并接收该帧；如果接收到的是带有标记的帧，对比自己的PVID，若相同则接收，不同则丢弃。
   - **发送数据时**：在发送数据前会对比vlan id标签，如果与自己的pvid相同，就剥离vlan标签后再发送；如果不同，则直接丢弃该帧。
2. **Trunk模式**
   - **接收数据时**：当接收到一个无标记帧时，打上自己的PVID，然后对比允许列表，如果有则接收，没有则丢弃；当接收到一个有标记的帧时，对比自己的PVID，若在允许列表中则接收，否则丢弃。
   - **发送数据时**：对比自己的PVID，如果相同，发送的时候就剥离vlan id标签发送；如果不同，则携带原来的id标签发送。
3. **Hybrid模式**
   - **接收数据时**：当接受到一个无标记帧的时候，查询允许列表，如果有就打上pvid接收，没有则不接收；当接受到一个有标记帧的时候，查询允许列表，有就接收，无则丢弃。
   - **发送数据时**：判断VLAN在本接口的属性是Untagged还是Tagged，如果是前者，先剥离该帧的VLAN标签再发送；如果是后者，则直接发送帧。

- 三层交换机端口在Hybrid模式下，具有以下属性：

1. **untag列表**：只在接口发送数据帧时起作用。如果需要发送的数据的VLAN标签在接口的untag列表中，那么将去除标签发送数据。
2. **tag列表**：作用于接收被标记的数据帧和发送数据帧。当接口接收到带有VLAN标签的数据帧时，该接口的tag列表相当于VLAN的允许列表，不在列表中的数据帧将被丢弃；当接口发送数据时，数据的vlan标签在接口的tag列表中，将保持标签发送数据帧，否则丢弃数据帧。
3. **PVID**：接口默认的PVID为VLAN1，PVID只在接收未标记的帧时才起作用。PVID用于在接收未标记数据帧时会给数据帧打上当前的PVID标识。